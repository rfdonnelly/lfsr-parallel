
<html>
  <head>
    <title>Parallel LFSR</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
  </head>
  <body>
    <script type="module">
      import init, { unroll_lfsr } from './pkg/lfsr_wasm.js';

      async function run() {
        await init();
        populateFormFromQueryParams();
        generateOutput();
      }

      function populateFormFromQueryParams() {
        var params = new URLSearchParams(location.search.slice(1));
        if (params.has("data-width")) {
          document.getElementById("data_width").value = params.get("data-width");
        }
        if (params.has("code-width")) {
          document.getElementById("code_width").value = params.get("code-width");
        }
        if (params.has("polynomial")) {
          document.getElementById("polynomial").value = params.get("polynomial");
        }
      }

      window.copyToClipboard = function copyToClipboard() {
        const text = document.getElementById("output").value;
        navigator.clipboard.writeText(text);
        return false;
      }

      window.generateOutput = function generateOutput() {
        var data_width = document.getElementById("data_width").value;
        var code_width = document.getElementById("code_width").value;
        var polynomial = document.getElementById("polynomial").value;
        window.history.replaceState({}, '', location.pathname + '?data-width=' + data_width + '&code-width=' + code_width + '&polynomial=' + polynomial);
        var output = unroll_lfsr(parseInt(data_width), parseInt(code_width), BigInt(polynomial));
        document.getElementById("output").value = "// Generated with " + location.href + "\n" + output;
        document.getElementById("permalink").href = location.href;
      }

      run();
    </script>

    <h1>Parallel LFSR Generator</h1>

    <p>
      Generate parallel Galois linear feedback shift registers (LFSRs) for implementing cyclic codes like CRC in hardware.
    </p>
    <p>
      The parallel version is computed by executing the LFSR symbolicly.
      Instead of feeding the LFSR the ones and zeros of a data word, the LFSR is fed the bits of the data word symbolically.
      For example, for a 8-bit data word, the LFSR is fed the symbols <code>d[7]</code>, <code>d[6]</code>, ..., <code>d[0]</code> instead of the actual ones and zeros.
    </p>

    <div>
      <div>
        <label for="data_width">Data width:</label>
        <input type="text" id="data_width" name="data_width" value="32">
      </div>
      <div>
        <label for="code_width">Code width:</label>
        <input type="text" id="code_width" name="code_width" value="8">
      </div>
      <div>
        <label for="polynomial">Polynomial:</label>
        <input type="text" id="polynomial" name="polynomial" value="0x07">
      </div>
    </div>

    <div style="padding-top: 1em; padding-bottom: 1em;">
        <button id="generate" onclick="generateOutput();">Generate</button>
    </div>

    <div style="border-style: solid; border-width: 1px;">
      <textarea id="output" wrap="off" cols="128" rows="20"></textarea>
    </div>

    <div style="padding-top: 1em; padding-bottom: 1em;">
      <div><a href="javascript:void(0);" onclick="copyToClipboard()">Copy to clipboard</a></div>
      <div><a id="permalink" href="#">Permalink</a></div>
      <div><a href="https://github.com/rfdonnelly/lfsr-parallel">Source</a></div>
    </div>

    <h2>References</h2>
    <dl>
      <dt>Galois LFSRs</dt>
      <dd><a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register#Galois_LFSRs">https://en.wikipedia.org/wiki/Linear-feedback_shift_register#Galois_LFSRs</a></dd>
      <dt>Cyclic redundancy check</dt>
      <dd><a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check">https://en.wikipedia.org/wiki/Cyclic_redundancy_check</a></dd>
      <dt>Computation of cyclic redundancy checks</dt>
      <dd><a href="https://en.wikipedia.org/wiki/Computation_of_cyclic_redundancy_checks">https://en.wikipedia.org/wiki/Computation_of_cyclic_redundancy_checks</a></dd>
      <dt>Easics CRC Generation Tool</dt>
      <dd><a href="https://www.easics.com/webtools/crctool">https://www.easics.com/webtools/crctool</a></dd>
    </dl>
  </body>
</html>
